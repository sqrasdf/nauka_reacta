<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="stylesheet" href="src/style.css" /> -->
    <script type="text/js">
      console.log("heh1e");
    </script>
  </head>
  <body>
    <div id="root"></div>

    <!-- <script src="index.js"></script> -->
    <script src="https://unpkg.com/supersimpledev/dayjs.js"></script>
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script type="text/babel">
      function ChatInput({ chatMessages, setChatMessages }) {
        const [inputText, setInputText] = React.useState("");
        const [isLoading, setIsLoading] = React.useState(false);

        function saveInputText(event) {
          setInputText(event.target.value);
        }

        async function sendMessage() {
          if (isLoading || !inputText) {
            // skip if message is loading or input is empty
            return;
          }

          const userMessage = {
            message: inputText,
            sender: "user",
            id: crypto.randomUUID(),
          };
          const tempRobotMessage = {
            message: "Loading...",
            sender: "robot",
            id: crypto.randomUUID(),
          };
          setChatMessages((prev) => [...prev, userMessage, tempRobotMessage]);
          setInputText("");

          setIsLoading(true);
          const response = await Chatbot.getResponseAsync(inputText);
          setIsLoading(false);

          setChatMessages((prev) =>
            prev.map((message) =>
              message.id === tempRobotMessage.id
                ? { ...message, message: response }
                : message
            )
          );
        }

        return (
          <>
            <input
              placeholder="Send a message to chatbot"
              size="30"
              onChange={saveInputText}
              value={inputText}
              onKeyDown={(e) => {
                if (e.key === "Enter") sendMessage();
              }}
              autoFocus
            />
            <button onClick={sendMessage}>Send</button>
          </>
        );
      }

      function ChatMessage({ message, sender }) {
        return (
          <div>
            {sender == "robot" && (
              <img
                src={
                  "https://raw.githubusercontent.com/sqrasdf/nauka_reacta/refs/heads/master/3/chatapp/robot.webp"
                }
                width="50px"
              />
            )}
            {message}
            {sender == "user" && (
              <img
                src={
                  "https://raw.githubusercontent.com/sqrasdf/nauka_reacta/refs/heads/master/3/chatapp/me.webp"
                }
                width="50px"
              />
            )}
          </div>
        );
      }

      function ChatMessages({ chatMessages }) {
        return (
          <>
            {chatMessages.map(({ message, sender, id }) => (
              <ChatMessage key={id} message={message} sender={sender} />
            ))}
          </>
        );
      }

      function App() {
        const [chatMessages, setChatMessages] = React.useState([
          {
            message: "hello chatbot",
            sender: "user",
            id: "id1",
          },
          {
            message: "hello! how can i help you?",
            sender: "robot",
            id: "id2",
          },
          {
            message: "can you tell me todays date?",
            sender: "user",
            id: "id3",
          },
          {
            message: "today is Sempember 9",
            sender: "robot",
            id: "id4",
          },
        ]);

        return (
          <>
            <ChatInput
              chatMessages={chatMessages}
              setChatMessages={setChatMessages}
            />
            <ChatMessages chatMessages={chatMessages} />
          </>
        );
      }

      // ---------Excercises------------------

      function Button({ counter, setCounter }) {
        // const [counter, setCounter] = React.useState(0);
        const text = counter == 1 ? "time" : "times";
        return (
          <button onClick={() => setCounter(counter + 1)}>
            Clicked {counter} {text}
          </button>
        );
      }

      function CounterApp() {
        const [counter, setCounter] = React.useState(0);
        return (
          <>
            <Button counter={counter} setCounter={setCounter} />
            <Button counter={counter} setCounter={setCounter} />
            <button onClick={() => setCounter(0)}>Reset</button>
          </>
        );
      }

      function DisplayApp() {
        const [inputText, setInputText] = React.useState("");
        const [messages, setMessages] = React.useState([]);

        function saveInputText(event) {
          setInputText(event.target.value);
        }

        return (
          <>
            <input
              onChange={(e) => {
                setInputText(e.target.value);
              }}
              placeholder="Enter a name here"
              value={inputText}
              onKeyDown={(e) => {
                if (e.key == "Enter") {
                  setMessages((prev) => {
                    const updated = [...prev, inputText];
                    console.log(updated);
                    setInputText("");
                    return updated;
                  });
                }
                if (e.key == "Escape") {
                  setInputText("");
                }
              }}
            />
            <button onClick={() => setInputText("")}>Reset</button>
            <button onClick={() => setInputText("World")}>Example</button>
            {messages.map((textValue) => (
              <p key={crypto.randomUUID()}>Hello {textValue}</p>
            ))}
          </>
        );
      }

      const rootDiv = document.getElementById("root");
      const root = ReactDOM.createRoot(rootDiv);
      root.render(<App />);
      // root.render(<CounterApp />);
      // root.render(<DisplayApp />);
    </script>
  </body>
</html>
